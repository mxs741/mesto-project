(()=>{"use strict";function e(e){"Escape"===e.key&&n(document.querySelector(".popup_opened"))}function t(t){t.classList.add("popup_opened"),document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",e)}document.querySelectorAll(".btn_type_close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return n(t)}))}));var r={url:"https://mesto.nomoreparties.co/v1/plus-cohort-16/",headers:{authorization:"c0fd3183-e813-469f-a9c4-cacdccd89151","content-type":"application/json"}};function o(){return fetch("".concat(r.url,"users/me"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var c=document.querySelector(".form__input_type_name"),a=document.querySelector(".form__input_type_link"),u=document.querySelector(".elements"),i=document.querySelector("#element-template").content,l=document.querySelector(".popup_element"),s=l.querySelector(".element__img_size_full"),d=l.querySelector(".element__img-caption");function m(e,n,c,a,u,m,_){var p,v,y=i.querySelector(".element").cloneNode(!0),h=y.querySelector(".element__title"),S=y.querySelector(".element__img"),q=y.querySelector(".btn_type_like"),k=y.querySelector(".btn_type_remove-card"),b=y.querySelector(".element__number-of-likes"),g=k.closest(".element");return h.textContent=e,S.src=n,S.alt=e,b.textContent=c||"0",q.addEventListener("click",(function(e){var t;f(m,_)?(t=u,fetch("".concat(r.url,"cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){m=e.likes,b.textContent=e.likes.length})).catch((function(e){return console.log(e)})):f(m,_)||function(e){return fetch("".concat(r.url,"cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(u).then((function(e){m=e.likes,b.textContent=e.likes.length})).catch((function(e){return console.log(e)})),function(e){e.target.classList.toggle("btn_type_like-active")}(e)})),S.addEventListener("click",(function(){d.textContent=e,s.src=n,s.alt=e,t(l)})),a&&(p=k,v=a,o().then((function(e){e._id!==v&&(p.style.display="none")}))),k.addEventListener("click",(function(){var e,t;e=g,t=u,fetch("".concat(r.url,"cards/").concat(t),{method:"DELETE",headers:r.headers}),e.remove()})),y}function f(e,t){return e.some((function(e){return e._id===t}))}function _(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("form__btn_inactive")):(t.disabled=!0,t.classList.add("form__btn_inactive"))}var p=document.querySelector(".popup_add"),v=document.querySelector(".profile__name"),y=document.querySelector(".profile__description"),h=document.querySelector(".popup_edit"),S=document.querySelector(".form__input_name"),q=document.querySelector(".form__input_description"),k=document.querySelector(".btn_type_edit"),b=document.querySelector(".btn_type_add"),g=document.querySelector(".form__edit"),L=document.querySelector(".form__add"),E=document.querySelector(".form__edit-avatar"),C=document.querySelector(".popup_edit-avatar"),x=document.querySelector(".profile__avatar-wrapper"),j=document.querySelector(".profile__avatar"),A=[];o().then((function(e){v.textContent=e.name,y.textContent=e.about,j.src=e.avatar;var t=e._id;fetch("".concat(r.url,"cards"),{headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){for(var t=0;t<e.length;t++)A.push({name:e[t].name,link:e[t].link,_id:e[t]._id,owner_id:e[t].owner._id,likes:e[t].likes})})).then((function(){A.forEach((function(e){u.append(m(e.name,e.link,e.likes.length,e.owner_id,e._id,e.likes,t))}))})).catch((function(e){return console.log(e)}))})),k.addEventListener("click",(function(){t(h),o().then((function(e){S.value=e.name,q.value=e.about})).catch((function(e){return console.log(e)}))})),g.addEventListener("submit",(function(e){var t,o=document.querySelector(".form__btn_edit-profile");e.preventDefault(),v.textContent=S.value,y.textContent=q.value,o.textContent="Сохранение...",(t={name:v.textContent,about:y.textContent},fetch("".concat(r.url,"users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t.name,about:t.about,avatar:t.avatar})})).then((function(){n(h),o.textContent="Сохранить"})).catch((function(e){return console.log(e)}))})),x.addEventListener("click",(function(){return t(C)})),E.addEventListener("submit",(function(e){var t,o=document.querySelector(".form__input-avatar-link"),c=document.querySelector(".form__btn_edit-avatar");e.preventDefault(),j.src=o.value,c.textContent="Сохранение...",(t={avatar:j.src},fetch("".concat(r.url,"users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t.avatar})})).then((function(){n(C),c.textContent="Сохранить"})).catch((function(e){return console.log(e)}))})),b.addEventListener("click",(function(){return t(p)})),L.addEventListener("submit",(function(e){var t,o,i=document.querySelector(".form__btn_type_create");e.preventDefault(),c.value,a.value,u.prepend(m(c.value,a.value)),i.textContent="Сохранение...",(t=c.value,o=a.value,fetch("".concat(r.url,"cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return console.log(e.json())}))).then((function(){e.target.reset(),i.disabled=!0,i.classList.add("form__btn_inactive"),n(p),i.textContent="Создать"})).catch((function(e){return console.log(e)}))})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){e.addEventListener("click",(function(e){e.target.classList.remove("popup_opened")}))})),Array.from(document.querySelectorAll(".form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".form__input")),n=e.querySelector(".form__btn");_(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("form__input_type_error"),n.classList.remove("form__error-message_activate"),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("form__input_type_error"),r.classList.add("form__error-message_activate"),r.textContent=n}(e,t,t.validationMessage)}(e,r),_(t,n)}))}))}(e)}))})();